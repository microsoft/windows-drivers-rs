name: Install LLVM
description: "Install LLVM using WinGet with version checking and error handling"

inputs:
  version:
    description: "LLVM version to install"
    required: true

runs:
  using: "composite"
  steps:
    - name: Validate inputs
      shell: pwsh
      run: |
        Set-StrictMode -Version Latest
        $ErrorActionPreference = 'Stop'

        $version = '${{ inputs.version }}'
        Write-Host "Validating LLVM installation inputs..."
        Write-Host "Version: $version"

        # Basic version format validation (LLVM uses semantic versioning)
        if ([string]::IsNullOrWhiteSpace($version)) {
            Write-Error "Version cannot be empty"
            exit 1
        }

        Write-Host "✅ Input validation passed"

    - name: Install LLVM
      uses: ./.github/actions/install-winget-package
      with:
        package-id: LLVM.LLVM
        version: ${{ inputs.version }}
        skip-if-installed: "true"

    - name: Verify LLVM installation
      shell: pwsh
      run: |
        Set-StrictMode -Version Latest
        $ErrorActionPreference = 'Stop'

        try {
          $clangVersion = clang --version
          Write-Host "✅ LLVM/Clang verification successful:"
          Write-Host $clangVersion
        } catch {
          Write-Error "❌ LLVM/Clang verification failed: $_"
          exit 1
        }
